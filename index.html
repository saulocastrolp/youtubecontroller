<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Music Connect</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href="style.css" rel="stylesheet">
    <script>
         let device = "pc"; // Defina como "mobile" se estiver no celular

async function getStatus() {
    const response = await fetch("http://localhost:3000/status");
    const data = await response.json();
    document.getElementById("video-title").innerText = data.title || "Nenhum v√≠deo/m√∫sica tocando";
    document.getElementById("channel-name").innerText = data.channel || "";
}

async function authenticate() {
    window.location.href = "http://localhost:3000/login";
}

async function sendCommand(endpoint) {
    await fetch(`http://localhost:3000/${endpoint}`, { method: "POST" });
}

async function transferPlayback() {
    const response = await fetch("http://localhost:3000/transfer", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ device: device === "pc" ? "mobile" : "pc" }),
    });

    const data = await response.json();

    if (data.videoId) {
        if (device === "pc") {
            window.open(`https://www.youtube.com/watch?v=${data.videoId}`, "_blank");
        } else {
            alert(`Reprodu√ß√£o transferida para o PC. Abra o YouTube e pesquise: ${data.videoId}`);
        }
    } else {
        alert("Nenhuma m√∫sica/v√≠deo dispon√≠vel para transferir.");
    }
}

async function sync() {
    const response = await fetch("http://localhost:3000/status");
    const data = await response.json();
    await fetch("http://localhost:3000/sync", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ device, track: data }),
    });
    alert("Sincronizado!");
}

setInterval(getStatus, 5000);
    </script>
</head>
<body>
    <div class="container">
        <h1>YouTube Music Connect</h1>
        <br/>
        <button class="btn btn-dark" onclick="authenticate()">üîë Login</button>
        <br/>
        <h2 id="music-title">Nenhuma m√∫sica tocando...</h2>
        <h3 id="artist-name"></h3>
    
        <div class="btn-group">
            <button class="btn btn-dark" onclick="sync()">üîÑ Sincronizar</button>
            <button class="btn btn-dark" onclick="transferPlayback()">üì≤ Transferir Reprodu√ß√£o</button>
        </div>
        <div class="btn-group">
            <button class="btn btn-dark" onclick="sendCommand('play')">‚ñ∂Ô∏è Play</button>
            <button class="btn btn-dark" onclick="sendCommand('pause')">‚è∏Ô∏è Pause</button>
            <button class="btn btn-dark" onclick="sendCommand('previous')">‚èÆÔ∏è Anterior</button>
            <button class="btn btn-dark" onclick="sendCommand('next')">‚è≠Ô∏è Pr√≥xima</button>
        </div>
        <div class="btn-group"></div>
            <button class="btn btn-dark" onclick="sendCommand('like')">‚ù§Ô∏è Curtir</button>
            <button class="btn btn-dark" onclick="sendCommand('dislike')">üëé N√£o Curtir</button>
            <button class="btn btn-dark" onclick="sendCommand('shuffle')">üîÄ Aleat√≥rio</button>
            <button class="btn btn-dark" onclick="sendCommand('repeat')">üîÅ Repetir</button>
        </div>
        
    
        <!--br><br>
        <div class="btn-group">
            <button class="btn btn-dark" onclick="syncMusic()">üîÑ Sincronizar M√∫sica</button>
            <button class="btn btn-dark" onclick="playOnDevice()">üì≤ Tocar no Celular/PC</button>
        </div-->
    </div>
    

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>
</html>
